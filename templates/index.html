<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>딥페이크 탐지기</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 600px; margin: auto; padding: 20px; background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; }
        #drop-area { border: 2px dashed #ccc; border-radius: 20px; padding: 40px; margin: 20px 0; cursor: pointer; transition: all 0.3s ease; }
        #drop-area:hover { background-color: #e9e9e9; border-color: #999; }
        #drop-area.highlight { border-color: #007bff; background-color: #eef; }
        #file-name { margin-top: 10px; font-weight: bold; }
        #result { margin-top: 30px; font-size: 1.2em; font-weight: bold; }
        .is-fake { color: #d9534f; }
        .is-real { color: #5cb85c; }
        .loading { color: #f0ad4e; }
        .error { color: #d9534f; }
        .button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>딥페이크 탐지기</h1>
        <p>비디오 파일을 아래에 드래그하거나 클릭하여 업로드하세요. 🧐</p>
        
        <div id="drop-area">
            <input type="file" id="fileElem" accept="video/*" style="display: none">
            <label class="button" for="fileElem">파일 선택</label>
            <p id="file-name"></p>
        </div>

        <div id="result"></div>
    </div>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileElem = document.getElementById('fileElem');
        const fileNameDisplay = document.getElementById('file-name');
        const resultDiv = document.getElementById('result');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt =>
            dropArea.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); }, false)
        );
        ['dragenter', 'dragover'].forEach(evt =>
            dropArea.addEventListener(evt, () => dropArea.classList.add('highlight'), false)
        );
        ['dragleave', 'drop'].forEach(evt =>
            dropArea.addEventListener(evt, () => dropArea.classList.remove('highlight'), false)
        );

        dropArea.addEventListener('drop', e => handleFiles(e.dataTransfer.files), false);
        dropArea.addEventListener('click', () => fileElem.click(), false);
        fileElem.addEventListener('change', e => handleFiles(e.target.files), false);

        function handleFiles(files) {
            const file = files && files[0];
            if (!file || !file.type.startsWith('video/')) {
                resultDiv.innerHTML = '<p class="error">비디오 파일만 업로드할 수 있습니다. 📹</p>';
                return;
            }

            fileNameDisplay.textContent = `선택된 파일: ${file.name}`;
            resultDiv.innerHTML = '<p class="loading">분석 중입니다... ⏳</p>';

            const formData = new FormData();
            // 🔧 핵심 수정: 서버가 기대하는 키 이름은 'file'
            formData.append('file', file);

            fetch('/predict', { method: 'POST', body: formData })
                .then(async (res) => {
                    let data;
                    try { data = await res.json(); } catch { throw new Error('Invalid JSON response'); }
                    if (!res.ok) throw new Error(data?.error || `HTTP ${res.status}`);
                    return data;
                })
                .then((data) => {
                    const isFake = data.is_fake ? '가짜' : '진짜';
                    const confidence = (data.prediction * 100).toFixed(2);
                    const resultClass = data.is_fake ? 'is-fake' : 'is-real';
                    const resultEmoji = data.is_fake ? '🚨' : '✅';
                    resultDiv.innerHTML = `
                        <h2>분석 결과 ${resultEmoji}</h2>
                        <p class="${resultClass}">이 비디오는 <strong>${isFake}</strong>일 확률이 ${confidence}% 입니다.</p>
                    `;
                })
                .catch((err) => {
                    resultDiv.innerHTML = `<p class="error">오류: ${err.message} ❌</p>`;
                });
        }
    </script>
</body>
</html>
